

<div class="chatboxcontainer">
    <div>
        <%= render 'shared/vertical-navbar' %>
    </div>
<div class="card mb-3" style="max-height: 600px;">
  <div class="col-md-6 col-lg-6">
    <%= cl_image_tag @match.item.pictures.first.key, class: "card-img-match" %>
  </div>

  <div class="col-md-6 col-lg-6">
    <%= cl_image_tag @match.other_item.pictures.first.key, class: "card-img-match" %>
  </div>
</div>
    <div class="form-container">
        <div class="chat-header">
          <div>
            <h1>
            <%= @match.user1.username %>
            </h1>
            <h1>
            <%= @match.user2.username %>
            </h1>
          </div>
            <h4>#
                <%= @match_chat_room_messages.name %>
            </h4>
        </div>
        <div class="messages">
            <% @match_chat_room_messages.messages.each do |message| %>
            <%= render "messages/message", message: message, user_is_messages_author: message.user == current_user %>
            <% end %>
        </div>
        <div id="create-message">
            <%= simple_form_for [ @match_chat_room_messages, Message.new ], url: match_chat_room_messages_path(chat_room_id: params[:id], match_id: params[:match_id]),remote: true, html: {autocomplete: "off" } do |f| %>
            <%= f.input :content, label: false, placeholder:"press enter to send the message" %>
            <% end %>
        </div>
    </div>
</div>

<% content_for :after_js do %>
<script>
const scrollLastMessageIntoView = () => {

    const messages = document.querySelectorAll('.message');
    const lastMessage = messages[messages.length - 1];

    if (lastMessage !== undefined) {
        lastMessage.scrollIntoView();
    }
}
scrollLastMessageIntoView();
App['chat_room_<%= params[:id] %>'] = App.cable.subscriptions.create({ channel: 'ChatRoomsChannel', chat_room_id: <%= params[:id] %> }, {
    received: (data) => {
        if (data.current_user_id !== <%= current_user.id %>) {
            const messagesContainer = document.querySelector('.messages');
            messagesContainer.insertAdjacentHTML('beforeend', data.message_partial);
            scrollLastMessageIntoView();
        }
    }
})
</script>
<% end %>
